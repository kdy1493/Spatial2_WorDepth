# NYU-Depth-v2 Matched Dataset with Relational Loss Training Configuration (Optimized)

# Overall
mode: train
model_name: nyu_matched_relational_train
pretrain: ./swin_large_patch4_window12_384_22k.pth

# Dataset
dataset: nyu_matched
data_path: /home/dongyub/WorDepth/matched_dataset/nyu-depth-v2-matched/
gt_path: /home/dongyub/WorDepth/matched_dataset/nyu-depth-v2-matched/
filenames_file: ./data_splits/nyu_matched_train_files_with_gt.txt
input_height: 480
input_width: 640
max_depth: 10               # NYU-matched: 0-10m range (scaled by /6553.5)

# Training (Optimized)
batch_size: 8               # ↓ from 8 (메모리 절약 및 속도 향상)
num_epochs: 30              # ↓ from 40 (시간 단축)
learning_rate: 3.0e-5
end_learning_rate: 1.0e-5
weight_decay: 0.0
adam_eps: 1.0e-3
num_threads: 8              # ↑ from 8 (데이터 로딩 병목 완화)
gpu_devices: "2,3,4,5"  # GPU device(s) to use (different from main training)
gradient_accumulation_steps: 4  # effective batch_size = 2 * 4 = 8

# Preprocessing
do_random_rotate: true
degree: 2.5

# Log and save
log_directory: ./models_1/
log_freq: 100
store_freq: 2500            # eval_freq와 동일하게 (metric과 checkpoint 동기화)
save_freq: 2500             # ✅ 더 자주 저장 (안전성)

# Online evaluation
do_online_eval: true
eval_freq: 2500            # ✅ 약 4.4 epoch마다 평가 (오버헤드 줄임)
data_path_eval: /home/dongyub/WorDepth/matched_dataset/nyu-depth-v2-matched/
gt_path_eval: /home/dongyub/WorDepth/matched_dataset/nyu-depth-v2-matched/
filenames_file_eval: ./data_splits/nyu_matched_test_files_with_gt.txt
min_depth_eval: 1.0e-3
max_depth_eval: 10       # NYU-matched: 0-10m range (scaled by /6553.5)
eigen_crop: true

# WorDepth
weight_kld: 1.0e-3
alter_prob: 0.5

# Relational Loss (NEW)
use_relational_loss: true
weight_relational: 0.1
relations_dir_train: /home/dongyub/WorDepth/matched_dataset/nyu-processed-matched2/train
relations_dir_eval: /home/dongyub/WorDepth/matched_dataset/nyu-processed-matched/test
margin_rank: 0.1      # margin for front/behind relations (meters)
margin_occ: 0.3       # margin for occlusion relations (meters, stronger)
lambda_occ: 1.5       # weight multiplier for occlusion
use_median_depth: false  # use mean depth (more stable gradient)
debug_relational: false
